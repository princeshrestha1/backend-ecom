{% extends 'base.html' %}
{% load staticfiles %}

{% block head_title %}
    {{block.super}} | Order List
{% endblock %}

{% block styles %}
<link type="text/css" rel="stylesheet" href="{% static 'dashboard/css/bootstrap-datetimepicker/bootstrap-datetimepicker.css' %}"/>

<!-- {% static 'dashboard/css/DataTables/jquery.dataTables.css' %}" />
<link type="text/css" rel="stylesheet" href="{% static 'dashboard/css/DataTables/extensions/dataTables.colVis.css' %}" />
<link type="text/css" rel="stylesheet" href="{% static 'dashboard/css/DataTables/extensions/dataTables.tableTools.css' %}" /> -->
<!-- <style>
    .dataTables_wrapper{
        width: 100% !important;
    }
</style> -->

{% endblock %}

{% block content%}
    <div class="app-main__inner">
        <div class="app-page-title pt-18">
            <div class="page-title-wrapper">
                <div class="page-title-heading">
                    <div class="card-body p-0">
                        <div class="mr-2 btn-group">
                            <h5 style="font-size: 18px;font-weight: 700;padding-bottom: 10px;">Order List</h5>
                        </div>
                    </div>
                </div>
                <div class="page-title-actions">
                    <div class="d-inline-block">
                        <a class="mb-2 mr-2 btn btn-light">
                                <span class="btn-icon-wrapper opacity-7">
                                <i class="fas fa-print"></i>
                            </span>
                        </a>
                    </div>

                    <div class="d-inline-block">
                        <a class="mb-2 mr-2 btn btn-primary color-white btn-open-options" href="javascript:void(0);">
                            <span class="btn-icon-wrapper pr-2 opacity-7">
                                <i class="fas fa-plus"></i>
                            </span>
                            New Order
                        </a>
                    </div>
                </div>    
            </div>
        </div>

        <div class="main-card mb-3 card">
            <div class="card-body">
                <form class="needs-validation" novalidate="" action="{% url 'cart:order_filter' %}" method="GET">
                    <div class="form-row">
                        <div class="col-md-4">
                            <label for="validationCustom01">What are you looking for?</label>
                            <input type="text" class="form-control" name="product" id="validationCustom01" placeholder="Search product name" required="">
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label for="validationCustom02">Category</label>
                            <select id="category-select" name="category" class="mb-2 form-control">
                                <option>Default Select</option>
                                {% for cat in categories %}
                                <option>{{cat.title}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="validationCustomUsername">Showing orders for</label>
                            <br/>
                            <input class="form-control" id="daterange" type="daterange" name="daterange" value="01/01/2020 - 01/15/2021" />
                        </div>
                        <div class="col-md-2 mb-3" style="text-align: center;vertical-align:middle;margin-top: 30px;">
                            <button class="btn btn-primary" id="orderSearch" type="submit" style="padding-left: 30px;padding-right: 30px;">SEARCH</button>
                        </div>
                    </div>
                </form>

                
            </div>
        </div>

        <div class="pt-20">
            <ul id="folder-tabs">
                <li><a href="#" name="tab1"><span><i class="fas fa-list-ul pr-2"></i></span>All Orders</a></li>
                <li><a href="#" name="tab2"><span><i class="fas fa-box pr-2"></i></span>Order Placed</a></li>
                <li><a href="#" name="tab3"><span><i class="fas fa-people-carry pr-2"></i></i></span>Order Confirmed</a></li>
                <li><a href="#" name="tab4"><span><i class="fas fa-shipping-fast pr-2"></i></span>Order Processed</a></li>
                <li><a href="#" name="tab5"><span><i class="fas fa-shipping-fast pr-2"></i></span>Ready to Ship</a></li>
                <li><a href="#" name="tab6"><span><i class="fas fa-shipping-fast pr-2"></i></span>Out for Delivery </a></li>
                <li><a href="#" name="tab7"><span><i class="fas fa-shipping-fast pr-2"></i></span>Delivered </a></li>
            </ul>

            <div id="content">
                <div id="tab1">
                    <div class="main-card mb-3 card" style="border-radius: 0px 10px 10px 10px;">
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                  <tr>
                                    <th class="bt-0" scope="col" width="2%"></th>
                                    <th class="bt-0" scope="col" width="10%">Order #</th>
                                    <th class="bt-0" scope="col" width="23%">Customer</th>
                                    <th class="bt-0" scope="col" width="10%">Product</th>
                                    <th class="bt-0" scope="col" width="15%">Delivery Address</th>
                                    <th class="bt-0" scope="col" width="10%">Purchase Date</th>
                                    <th class="bt-0" scope="col" width="10%">Ship By</th>
                                    <th class="bt-0" scope="col" width="10%">Status</th>
                                    <th class="bt-0" scope="col" width="10%">Action</th>

                                  </tr>
                                </thead>
                                <tbody>
                                    {% for order in object_list %}
                                    <tr>
                                        <td>
                                          <div class="custom-control custom-checkbox">
                                              <input type="checkbox" class="custom-control-input" id="customCheck1" >
                                              <label class="custom-control-label" for="customCheck1"></label>
                                          </div>
                                        </td>
                                        <td>{{order.code}}</td>
                                        <td>
                                            <div class="row pt-10 pb-10">
                                                <div class="col-md-2">
                                                    <img width="42" class="rounded-circle" src="{% static 'dashboard/img/user.png' %}" alt="">
                                                </div>
                                                <div class="col-md-10">
                                                    <a href="{% url 'cart:order_details' order.id %}">
                                                        <p class="mb-0 bold">{{order.user.first_name}}{{order.user.last_name}}</p>
                                                        <p class="mb-0 text-mute">{{order.user.email}}</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{% for product in order.products.all %}{{product.products.name}}{% endfor %}</td>
                                        <td>{{order.user.user_shipping_addr.all.0.full_address}}</td>
                                        <td>{{order.created_at|date}}</td>
                                        <td>{{order.shipped_date|date}}</td>
                                        <td class="badge-packaging"><i class="fas fa-dot-circle mr-2"></i>{{order.condition_status.get_name_display}}</td>
                                        <td>
                                            <a href="{% url 'cart:orders_update' order.id %}" >
                                                <i class="fas fa-eye" style="color: #5DADE2;"></i>&nbsp;
                                                </a>
                                            <a href="#" class="js-toggle-cart" data-id="{{order.id}}">
                                                    <i class="fas fa-sync" style="color: #5DADE2;"></i>&nbsp;
                                                </a>
                                                {% comment %}
                                            <form method= "POST" action="{% url 'cart:confirm_order_by_cms' order.id %}">
                                                {% csrf_token %}
                                                <button type="submit" style="border: none; background: white; font-color:#000000; margin-left: 10px;">{% if order.is_confirmed == False %}<i class="fa fa-check"></i> {% else %}<i class="fa fa-times"></i>{% endif %}</button>
                                            </form>
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                              </table>
                        </div>
                    </div>
                </div>
                <div id="tab2">
                    <div class="main-card mb-3 card" style="border-radius: 0px 10px 10px 10px;">
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                  <tr>
                                    <th class="bt-0" scope="col" width="2%"></th>
                                    <th class="bt-0" scope="col" width="10%">Order #</th>
                                    <th class="bt-0" scope="col" width="23%">Customer</th>
                                    <th class="bt-0" scope="col" width="10%">Product</th>
                                    <th class="bt-0" scope="col" width="15%">Delivery Address</th>
                                    <th class="bt-0" scope="col" width="10%">Purchase Date</th>
                                    <th class="bt-0" scope="col" width="10%">Ship By</th>
                                    <th class="bt-0" scope="col" width="10%">Status</th>
                                    <th class="bt-0" scope="col" width="10%">Action</th>

                                  </tr>
                                </thead>
                                <tbody>
                                    {% for order in object_list %}
                                    {% if order.condition_status.name == 'Order Placed' %}
                                    <tr>
                                        <td>
                                          <div class="custom-control custom-checkbox">
                                              <input type="checkbox" class="custom-control-input" id="customCheck1" >
                                              <label class="custom-control-label" for="customCheck1"></label>
                                          </div>
                                        </td>
                                        <td>{{order.code}}</td>
                                        <td>
                                            <div class="row pt-10 pb-10">
                                                <div class="col-md-2">
                                                    <img width="42" class="rounded-circle" src="{% static 'dashboard/img/user.png' %}" alt="">
                                                </div>
                                                <div class="col-md-10">
                                                    <a href="{% url 'cart:order_details' order.id %}">
                                                        <p class="mb-0 bold">{{order.user.first_name}}{{order.user.last_name}}</p>
                                                        <p class="mb-0 text-mute">{{order.user.email}}</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{% for product in order.products.all %}{{product.products.name}}{% endfor %}</td>
                                        <td>{{order.user.user_shipping_addr.all.0.full_address}}</td>
                                        <td>{{order.created_at|date}}</td>
                                        <td>{{order.shipped_date|date}}</td>
                                        <td class="badge-packaging"><i class="fas fa-dot-circle mr-2"></i>{{order.condition_status.get_name_display}}</td>
                                        <td>
                                            <a href="{% url 'cart:orders_update' order.id %}" >
                                                <i class="fas fa-eye" style="color: #5DADE2;"></i>&nbsp;
                                                 </a>
                                            <a href="#" class="js-toggle-cart" data-id="{{order.id}}">
                                                    <i class="fas fa-sync" style="color: #5DADE2;"></i>&nbsp;</a>
                                            {% comment %}
                                            <form method= "POST" action="{% url 'cart:confirm_order_by_cms' order.id %}">
                                                {% csrf_token %}
                                                <button type="submit" style="border: none; background: white; font-color:#000000; margin-left: 10px;">{% if order.is_confirmed == False %}<i class="fa fa-check"></i> {% else %}<i class="fa fa-times"></i>{% endif %}</button>
                                            </form>
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                              </table>
                        </div>
                    </div>
                </div>
                <div id="tab3">
                    <div class="main-card mb-3 card" style="border-radius: 0px 10px 10px 10px;">
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                  <tr>
                                    <th class="bt-0" scope="col" width="2%"></th>
                                    <th class="bt-0" scope="col" width="10%">Order #</th>
                                    <th class="bt-0" scope="col" width="23%">Customer</th>
                                    <th class="bt-0" scope="col" width="10%">Product</th>
                                    <th class="bt-0" scope="col" width="15%">Delivery Address</th>
                                    <th class="bt-0" scope="col" width="10%">Purchase Date</th>
                                    <th class="bt-0" scope="col" width="10%">Ship By</th>
                                    <th class="bt-0" scope="col" width="10%">Status</th>
                                    <th class="bt-0" scope="col" width="10%">Action</th>

                                  </tr>
                                </thead>
                                <tbody>
                                    {% for order in object_list %}
                                    {% if order.condition_status.name == 'Order Confirmed' %}
                                    <tr>
                                        <td>
                                          <div class="custom-control custom-checkbox">
                                              <input type="checkbox" class="custom-control-input" id="customCheck1" >
                                              <label class="custom-control-label" for="customCheck1"></label>
                                          </div>
                                        </td>
                                        <td>{{order.code}}</td>
                                        <td>
                                            <div class="row pt-10 pb-10">
                                                <div class="col-md-2">
                                                    <img width="42" class="rounded-circle" src="{% static 'dashboard/img/user.png' %}" alt="">
                                                </div>
                                                <div class="col-md-10">
                                                    <a href="{% url 'cart:order_details' order.id %}">
                                                        <p class="mb-0 bold">{{order.user.first_name}}{{order.user.last_name}}</p>
                                                        <p class="mb-0 text-mute">{{order.user.email}}</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{% for product in order.products.all %}{{product.products.name}}{% endfor %}</td>
                                        <td>{{order.user.user_shipping_addr.all.0.full_address}}</td>
                                        <td>{{order.created_at|date}}</td>
                                        <td>{{order.shipped_date|date}}</td>
                                        <td class="badge-packaging"><i class="fas fa-dot-circle mr-2"></i>{{order.condition_status.get_name_display}}</td>
                                        <td>
                                            <a href="{% url 'cart:orders_update' order.id %}" >
                                                <i class="fas fa-eye" style="color: #5DADE2;"></i>&nbsp;
                                </a>
                                            <a href="#" class="btn btn-default js-toggle-cart" data-id="{{order.id}}">
                                                    <i class="fas fa-sync" style="color: #5DADE2;"></i>&nbsp;
                                                </a>
                                            {% comment %}
                                            <form method= "POST" action="{% url 'cart:confirm_order_by_cms' order.id %}">
                                                {% csrf_token %}
                                                <button type="submit" style="border: none; background: white; font-color:#000000; margin-left: 10px;">{% if order.is_confirmed == False %}<i class="fa fa-check"></i> {% else %}<i class="fa fa-times"></i> {% endif %}</button>
                                            </form>
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                              </table>
                        </div>
                    </div>
                </div>
                <div id="tab4">
                    <div class="main-card mb-3 card" style="border-radius: 0px 10px 10px 10px;">
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                  <tr>
                                    <th class="bt-0" scope="col" width="2%"></th>
                                    <th class="bt-0" scope="col" width="10%">Order #</th>
                                    <th class="bt-0" scope="col" width="23%">Customer</th>
                                    <th class="bt-0" scope="col" width="10%">Product</th>
                                    <th class="bt-0" scope="col" width="15%">Delivery Address</th>
                                    <th class="bt-0" scope="col" width="10%">Purchase Date</th>
                                    <th class="bt-0" scope="col" width="10%">Ship By</th>
                                    <th class="bt-0" scope="col" width="10%">Status</th>
                                    <th class="bt-0" scope="col" width="10%">Action</th>

                                  </tr>
                                </thead>
                                <tbody>
                                    {% for order in object_list %}
                                    {% if order.condition_status.name == 'Order Processed' %}
                                    <tr>
                                        <td>
                                          <div class="custom-control custom-checkbox">
                                              <input type="checkbox" class="custom-control-input" id="customCheck1" >
                                              <label class="custom-control-label" for="customCheck1"></label>
                                          </div>
                                        </td>
                                        <td>{{order.code}}</td>
                                        <td>
                                            <div class="row pt-10 pb-10">
                                                <div class="col-md-2">
                                                    <img width="42" class="rounded-circle" src="{% static 'dashboard/img/user.png' %}" alt="">
                                                </div>
                                                <div class="col-md-10">
                                                    <a href="{% url 'cart:order_details' order.id %}">
                                                        <p class="mb-0 bold">{{order.user.first_name}}{{order.user.last_name}}</p>
                                                        <p class="mb-0 text-mute">{{order.user.email}}</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{% for product in order.products.all %}{{product.products.name}}{% endfor %}</td>
                                        <td>{{order.user.user_shipping_addr.all.0.full_address}}</td>
                                        <td>{{order.created_at|date}}</td>
                                        <td>{{order.shipped_date|date}}</td>
                                        <td class="badge-packaging"><i class="fas fa-dot-circle mr-2"></i>{{order.condition_status.get_name_display}}</td>
                                        <td>
                                            <a href="{% url 'cart:orders_update' order.id %}" >
                                                <i class="fas fa-eye" style="color: #5DADE2;"></i>&nbsp;
                                </a>
                                            <a href="#" class="js-toggle-cart" data-id="{{order.id}}">
                                                    <i class="fas fa-sync" style="color: #5DADE2;"></i>&nbsp;
                                                </a>
                                            {% comment %}
                                            <form method= "POST" action="{% url 'cart:confirm_order_by_cms' order.id %}">
                                                {% csrf_token %}
                                                <button type="submit" style="border: none; background: white; font-color:#000000; margin-left: 10px;">{% if order.is_confirmed == False %}<i class="fa fa-check"></i> {% else %}<i class="fa fa-times"></i> {% endif %}</button>
                                            </form>
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                              </table>
                        </div>
                    </div>
                </div>
                <div id="tab5">
                    <div class="main-card mb-3 card" style="border-radius: 0px 10px 10px 10px;">
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                  <tr>
                                    <th class="bt-0" scope="col" width="2%"></th>
                                    <th class="bt-0" scope="col" width="10%">Order #</th>
                                    <th class="bt-0" scope="col" width="23%">Customer</th>
                                    <th class="bt-0" scope="col" width="10%">Product</th>
                                    <th class="bt-0" scope="col" width="15%">Delivery Address</th>
                                    <th class="bt-0" scope="col" width="10%">Purchase Date</th>
                                    <th class="bt-0" scope="col" width="10%">Ship By</th>
                                    <th class="bt-0" scope="col" width="10%">Status</th>
                                    <th class="bt-0" scope="col" width="10%">Action</th>

                                  </tr>
                                </thead>
                                <tbody>
                                    {% for order in object_list %}
                                    {% if order.condition_status.name == 'Ready to Ship' %}
                                    <tr>
                                        <td>
                                          <div class="custom-control custom-checkbox">
                                              <input type="checkbox" class="custom-control-input" id="customCheck1" >
                                              <label class="custom-control-label" for="customCheck1"></label>
                                          </div>
                                        </td>
                                        <td>{{order.code}}</td>
                                        <td>
                                            <div class="row pt-10 pb-10">
                                                <div class="col-md-2">
                                                    <img width="42" class="rounded-circle" src="{% static 'dashboard/img/user.png' %}" alt="">
                                                </div>
                                                <div class="col-md-10">
                                                    <a href="{% url 'cart:order_details' order.id %}">
                                                        <p class="mb-0 bold">{{order.user.first_name}}{{order.user.last_name}}</p>
                                                        <p class="mb-0 text-mute">{{order.user.email}}</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{% for product in order.products.all %}{{product.products.name}}{% endfor %}</td>
                                        <td>{{order.user.user_shipping_addr.all.0.full_address}}</td>
                                        <td>{{order.created_at|date}}</td>
                                        <td>{{order.shipped_date|date}}</td>
                                        <td class="badge-packaging"><i class="fas fa-dot-circle mr-2"></i>{{order.condition_status.get_name_display}}</td>
                                        <td>
                                            <a href="{% url 'cart:orders_update' order.id %}" >
                                                <i class="fas fa-eye" style="color: #5DADE2;"></i>&nbsp;
                                </a>
                                            <a href="#" class="js-toggle-cart" data-id="{{order.id}}">
                                                    <i class="fas fa-sync" style="color: #5DADE2;"></i>&nbsp;
                                                </a>
                                            {% comment %}
                                            <form method= "POST" action="{% url 'cart:confirm_order_by_cms' order.id %}">
                                                {% csrf_token %}
                                                <button type="submit" style="border: none; background: white; font-color:#000000; margin-left: 10px;">{% if order.is_confirmed == False %}<i class="fa fa-check"></i> {% else %}<i class="fa fa-times"></i> {% endif %}</button>
                                            </form>
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                              </table>
                        </div>
                    </div>
                </div>
                <div id="tab6">
                    <div class="main-card mb-3 card" style="border-radius: 0px 10px 10px 10px;">
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                  <tr>
                                    <th class="bt-0" scope="col" width="2%"></th>
                                    <th class="bt-0" scope="col" width="10%">Order #</th>
                                    <th class="bt-0" scope="col" width="23%">Customer</th>
                                    <th class="bt-0" scope="col" width="10%">Product</th>
                                    <th class="bt-0" scope="col" width="15%">Delivery Address</th>
                                    <th class="bt-0" scope="col" width="10%">Purchase Date</th>
                                    <th class="bt-0" scope="col" width="10%">Ship By</th>
                                    <th class="bt-0" scope="col" width="10%">Status</th>
                                    <th class="bt-0" scope="col" width="10%">Action</th>

                                  </tr>
                                </thead>
                                <tbody>
                                    {% for order in object_list %}
                                    {% if order.condition_status.name == 'Out for Delivery' %}
                                    <tr>
                                        <td>
                                          <div class="custom-control custom-checkbox">
                                              <input type="checkbox" class="custom-control-input" id="customCheck1" >
                                              <label class="custom-control-label" for="customCheck1"></label>
                                          </div>
                                        </td>
                                        <td>{{order.code}}</td>
                                        <td>
                                            <div class="row pt-10 pb-10">
                                                <div class="col-md-2">
                                                    <img width="42" class="rounded-circle" src="{% static 'dashboard/img/user.png' %}" alt="">
                                                </div>
                                                <div class="col-md-10">
                                                    <a href="{% url 'cart:order_details' order.id %}">
                                                        <p class="mb-0 bold">{{order.user.first_name}}{{order.user.last_name}}</p>
                                                        <p class="mb-0 text-mute">{{order.user.email}}</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{% for product in order.products.all %}{{product.products.name}}{% endfor %}</td>
                                        <td>{{order.user.user_shipping_addr.all.0.full_address}}</td>
                                        <td>{{order.created_at|date}}</td>
                                        <td>{{order.shipped_date|date}}</td>
                                        <td class="badge-packaging"><i class="fas fa-dot-circle mr-2"></i>{{order.condition_status.get_name_display}}</td>
                                        <td>
                                            <a href="{% url 'cart:orders_update' order.id %}" >
                                                <i class="fas fa-eye" style="color: #5DADE2;"></i>&nbsp;
                                </a>
                                            <a href="#" class="js-toggle-cart" data-id="{{order.id}}">
                                                    <i class="fas fa-sync" style="color: #5DADE2;"></i>&nbsp;
                                                </a>
                                            {% comment %}
                                            <form method= "POST" action="{% url 'cart:confirm_order_by_cms' order.id %}">
                                                {% csrf_token %}
                                                <button type="submit" style="border: none; background: white; font-color:#000000; margin-left: 10px;">{% if order.is_confirmed == False %}<i class="fa fa-check"></i> {% else %}<i class="fa fa-times"></i> {% endif %}</button>
                                            </form>
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                              </table>
                        </div>
                    </div>
                </div>
                <div id="tab7">
                    <div class="main-card mb-3 card" style="border-radius: 0px 10px 10px 10px;">
                        <div class="card-body">
                            <table class="table table-hover">
                                <thead>
                                  <tr>
                                    <th class="bt-0" scope="col" width="2%"></th>
                                    <th class="bt-0" scope="col" width="10%">Order #</th>
                                    <th class="bt-0" scope="col" width="23%">Customer</th>
                                    <th class="bt-0" scope="col" width="10%">Product</th>
                                    <th class="bt-0" scope="col" width="15%">Delivery Address</th>
                                    <th class="bt-0" scope="col" width="10%">Purchase Date</th>
                                    <th class="bt-0" scope="col" width="10%">Ship By</th>
                                    <th class="bt-0" scope="col" width="10%">Status</th>
                                    <th class="bt-0" scope="col" width="10%">Action</th>

                                  </tr>
                                </thead>
                                <tbody>
                                    {% for order in object_list %}
                                    {% if order.condition_status.name == 'Delivered' %}
                                    <tr>
                                        <td>
                                          <div class="custom-control custom-checkbox">
                                              <input type="checkbox" class="custom-control-input" id="customCheck1" >
                                              <label class="custom-control-label" for="customCheck1"></label>
                                          </div>
                                        </td>
                                        <td>{{order.code}}</td>
                                        <td>
                                            <div class="row pt-10 pb-10">
                                                <div class="col-md-2">
                                                    <img width="42" class="rounded-circle" src="{% static 'dashboard/img/user.png' %}" alt="">
                                                </div>
                                                <div class="col-md-10">
                                                    <a href="{% url 'cart:order_details' order.id %}">
                                                        <p class="mb-0 bold">{{order.user.first_name}}{{order.user.last_name}}</p>
                                                        <p class="mb-0 text-mute">{{order.user.email}}</p>
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>{% for product in order.products.all %}{{product.products.name}}{% endfor %}</td>
                                        <td>{{order.user.user_shipping_addr.all.0.full_address}}</td>
                                        <td>{{order.created_at|date}}</td>
                                        <td>{{order.shipped_date|date}}</td>
                                        <td class="badge-packaging"><i class="fas fa-dot-circle mr-2"></i>{{order.condition_status.get_name_display}}</td>
                                        <td>
                                            <a href="{% url 'cart:orders_update' order.id %}" >
                                                <i class="fas fa-eye" style="color: #5DADE2;"></i>&nbsp;
                                </a>
                                            <a href="#" class="js-toggle-cart" data-id="{{order.id}}">
                                                    <i class="fas fa-sync" style="color: #5DADE2;"></i>&nbsp;
                                                </a>
                                            {% comment %}
                                            <form method= "POST" action="{% url 'cart:confirm_order_by_cms' order.id %}">
                                                {% csrf_token %}
                                                <button type="submit" style="border: none; background: white; font-color:#000000; margin-left: 10px;">{% if order.is_confirmed == False %}<i class="fa fa-check"></i> {% else %}<i class="fa fa-times"></i> {% endif %}</button>
                                            </form>
                                            {% endcomment %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                              </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="ui-theme-settings">
        <div class="theme-settings__inner">
            <div class="scrollbar-container">
                <div class="theme-settings__options-wrapper p-20">
                    <div class="row">
                        <div class="col-md-2">
                            <div class="mb-3 card text-white card-body bg-success card-fa">
                                <i class="fas fa-file-alt"></i>
                            </div>
                        </div>
                        <div class="col-md-8 mt--10">
                            <p class="text-muted mb-0">2 December 2020</p>
                            <h5 class="bold">New Order Placement</h5>
                        </div>
                        <div class="col-md-2">
                            <a class="btn-open-options" href="javascript:void(0);">
                                <i class="fas fa-times font-22"></i>
                            </a>
                        </div>
                    </div>
                    <div>
                        <p>
                            <img width="42" class="rounded-circle" src="{% static 'dashboard/images/avatars/2.jpg' %}">
                            &emsp;<span>Ronesh Shrestha</span>
                        </p>

                        <form class="" method="POST" action="{% url 'cart:make_order' %}">
                            {% csrf_token %}
                            <div class="position-relative form-group">
                                <label for="{{orderCMSForm.products.id_for_label}}" class="">Product Name</label>
                                {{orderCMSForm.products}}
                            </div>
                            <div class="position-relative form-group">
                                <label for="{{orderCMSForm.quantity.id_for_label}}" class="">Product Quantity</label>
                                {{orderCMSForm.quantity}}
                            </div>
                            <div class="position-relative form-group">
                                <label for="{{orderCMSForm.email.id_for_label}}" class="">Customer Email</label>
                                {{orderCMSForm.email}}
                            </div>
                            <div class="position-relative form-group">
                                <label for="{{orderCMSForm.contact_number.id_for_label}}" class="">Customer Contact Number</label>
                                {{orderCMSForm.contact_number}}
                            </div>
                            <div class="position-relative form-group">
                                <label for="product-delivery" class="">To be delivered in</label>
                                {{orderCMSForm.shipped_date}}
                            </div>
                            <div class="position-relative form-group"><label for="exampleFile" class="">Additional File</label><input name="file" id="exampleFile" type="file" class="form-control-file">
                                <small class="form-text text-muted">If there are any additional files to be included in this order, please provide the file.</small>
                            </div>
                            <div class="text-right">
                                <button type="submit" class="mt-1 btn btn-primary text-right pl-pr-40">Place order</button>
                            </div>
                        </form>
                            
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <aside class="cart js-cart">
        <div class="cart__header">
            <h1 class="cart__title font-18 fw-700">Update Status</h1>
            <p class="cart__text">
                <a class="button button--light js-toggle-cart" href="#" title="Close cart">
                    <i class="fas fa-times" style="font-size: 22px;"></i>
                </a>
            </p>
        </div>
        <div class="modal-content pt-80">
            <div class="modal-body">
                <form class="form" id="changeStatusForm" role="form" action="" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-12 col-sm-12">
                            <p>
                                <div id="error_quantity" style="margin: auto; color:red;"></div>
                                <div class="form-group">                     
                                    <div>
                                        <div class="form-group required">
                                            <label><span class="control-labels">Condition</span></label>
                                            {{ form.condition_status }}
                                        </div>
                                    </div>
                                    <div>
                                        <div class="form-group">
                                            <label><span class="control-labels">Date and Time:</span></label>
                                            {{ form.shipped_date }}
                                        </div>
                                    </div>
                                    {% comment %}
                                    <div>
                                        <div class="row">
                                            <div class="col-md-10 col-sm-10">
                                                <div class="form-group floating-label" style="display: block;">
                                                    <label><span class="control-labels">Code:</span></label>
                                                    {{ form.code }}
                                                </div>
                                            </div>
                                                <div class="col-md-2 col-sm-2"  style="padding-top:20px;padding-left:75px;">
                                                    <input type="button" class="btn ink-reaction btn-primary btn-raised" value="Generate" onClick="generate();">
                                                </div>
        
                                            </div>
                                        </div>
                                        {% endcomment %}
                                    
                                    <div class="refund-with-stock">
                                        <div>
                                            {% for refund in object.refund.all %}
                                            <div class="refund-form">
                                                <input type="hidden" class="refund-id" value="{{ refund.pk }}">
                                                <div class="form-group product-e required">
                                                    <div style="padding-bottom: 5px;">
                                                        <label><span class="control-labels">Products</span></label>
                                                    </div>
                                                    <select name="products" class="form-control product-select2 refund-product" disabled="true">
                                                            <option value="">------------</option>
                                                        {% for product in object.products.all  %} 
                                                        <option value="{{ product.id }}" {% if product.pk == refund.products.pk %}selected{% endif %}>{{ product.products.name }} (Quantity: {{ product.quantity }})</option>
                                                        {% endfor %}
                                                    </select>       
                                                </div>
                                                <div>
                                                    <div class="form-group floating-label required">
                                                        <input type="number" name="quantity" class="form-control product-quantity refund-quantity" value="{{ refund.quantity }}" />
                                                        <label><span class="control-labels">Quantity</span></label>
                                                    </div>
                                                </div>
                                            </div>
        
                                            {% endfor %}
                                                <span class="errors"></span>
                                        </div>
                                        {% if object.refund.count < object.products.count %}
                                        <div class="refund-product" id="refund-product">
                                            <div class="refund-form">
                                                <input type="hidden" class="refund-id" value="">
                                                <div class="form-group product-e">
                                                    <div style="padding-bottom: 5px;">
                                                        <label class="required" ><span class="control-label">Products</span></label>
                                                    </div>
                                                    <select name="products" class="form-control product-select2 ">
                                                            <option value="">------------</option>
                                                        {% for product in object.products.all  %} 
                                                        <option value="{{ product.id }}">{{ product.products.name }} (Quantity: {{ product.quantity }})</option>
                                                        {% endfor %}
                                                    </select>       
                                                </div>
                                                <div>
                                                    <div class="form-group floating-label required">
                                                        <input type="number" name="quantity" class="form-control product-quantity refund-quantity" />
                                                        <label><span class="control-labels">Quantity</span></label>
                                                    </div>
                                                </div>
                                            </div>
                                            <span class="errors"></span>
                                        </div>
                                        <a style="margin-top: 10px; float: left!important;" id="addrefundproduct" class="btn ink-reaction btn-floating-action btn-primary"><i class="fa fa-plus"></i></a>
                                        {% endif %}
                                    </div>
                                </div>                            
                            </p>
                                <div class="col-xs-12 text-right">
                                    <button class="btn ink-reaction btn-primary btn-raised btn-submit" type="submit">{% if object %}Update{% else %}Save{% endif %}</button>
                                </div>
            
                        </div>
                    </div>
                    </form>
            </div>
        </div>
    </aside>
    
    <div class="lightbox js-lightbox js-toggle-cart"></div>
{% endblock %}

{% block js %}
<script src="{% static 'dashboard/js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js' %}"></script>


    <script>
        $(document).ready(function() {
            $("#content").find("[id^='tab']").hide(); // Hide all content
            $("#folder-tabs li:first").attr("id","current"); // Activate the first tab
            $("#content #tab1").fadeIn(); // Show first tab's content

            $('#folder-tabs a').click(function(e) {
                e.preventDefault();
                if ($(this).closest("li").attr("id") == "current"){ //detection for current tab
                 return;
                }
                else{
                  $("#content").find("[id^='tab']").hide(); // Hide all content
                  $("#folder-tabs li").attr("id",""); //Reset id's
                  $(this).parent().attr("id","current"); // Activate this
                  $('#' + $(this).attr('name')).fadeIn(); // Show content for the current tab
                }
            });
        });
    </script>
    <script>
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
    <script>
        $(function() {
            $('input[name="daterange"]').daterangepicker({
                opens: 'left'
            }, function(start, end, label) {
                console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
            });
        });
    </script>

<script type="text/javascript">
    var cartOpen = false;

    $('body').on('click', '.js-toggle-cart', toggleCart);

    function toggleCart(e) {
        e.preventDefault();
        var id = $(this).attr('data-id');
        e.preventDefault();
        $('#changeStatusForm').attr('action', "/order/ship/"+id+"/update/");
      if(cartOpen) {
        closeCart();
        return;
      }
      openCart();
    }

    function openCart() {
      cartOpen = true;
      $('body').addClass('open');
    }

    function closeCart() {
      cartOpen = false;
      $('body').removeClass('open');
    }
</script>


<script type="text/javascript">

	var $mainRefundForm = $('.refund-product').find('.refund-form').clone();
	var productCount = '{{ object.products.count }}';
	var formCount = $('.refund-form').length;

	if(productCount == formCount){
		$('#addrefundproduct').hide();
	}

	$('#addrefundproduct').click(function(e){
		e.preventDefault();

		if(formCount >= productCount){
			alert('Cannot add new  product');
			return;
		}
		var $element = $mainRefundForm.clone();
		$('.refund-product').append($element);

		formCount++;
		if(formCount == productCount)
			$(this).hide();		
		
		$('.product-select2').select2();
		


    })
    
    $('.datetimepicker').datetimepicker({
				locale: 'en',
				sideBySide: true,
				format:'YYYY-MM-DD HH:mm',
			});

		$('#select-list').select2();
		$('.product-select2').select2();
		$(function () {
			$('.datetimepicker').datetimepicker({
				locale: 'en',
				sideBySide: true,
				format:'YYYY-MM-DD HH:mm',
			});
		});

</script>
<script type="text/javascript">
    $('#statusForm').addClass('active')
    function randomPassword(length) {
        var chars = "ABCDEFGHIJKLMNOP1234567890";
        var pass = "";
        for (var x = 0; x < length; x++) {
            var i = Math.floor(Math.random() * chars.length);
            pass += chars.charAt(i);
        }
        return pass;
    }

    function generate() {
        changeStatusForm.code.value = randomPassword(6);
        console.log( randomPassword(6));
    }
</script>
<script>  

	$(document).ready(function(){

		$('body').on('change', '.product-select2', function(){
			var that = this;
			var parent = $(this).parents('.refund-form').get(0);
			$('.refund-form').each(function(index, element){
				if( element == parent){
					return;
				}
				else {
					var element_value = $(element).find('.product-select2 :selected').val();
					var parent_value = $(parent).find('.product-select2 :selected').val();
					if(element_value === parent_value){
						$(parent).find('.product-e').find('.errors').empty();
						$(parent).find('.product-e').append("<span class='errors' style='color:red;'>Product has been already selected</span>");
						$(that).val("");
						$(that).select2();
					}
					else $('.errors').hide();
				}
			})
		});

		$('.btn-submit').click(function(event){
			if( $('#id_condition_status').find(":selected").text() == 'Refunded with Stock' ){
				event.preventDefault();

				console.log('Update Click');
				var products_refund = []
				var refundwithstock = $('.refund-with-stock');
				
				refundwithstock.find('.refund-form').each(function(index, element){
					var id = $(element).find('.refund-id').val();
					var product_id = $(element).find('.product-select2 :selected').val()
					var quantity = $(element).find('.refund-quantity').val()
					
					products_refund.push({
						'id':id, 
						'product_id':product_id, 
						'quantity':quantity})
				});
				console.log(products_refund)
				$(this).text('Updating...');

				$.ajax({
                    {% comment %}
                    url: `{% url 'cart:order_refund' object.pk %}`,
                    {% endcomment %}
					method:'POST',
					headers: {
						'X-CSRFToken': $('meta[name="csrf-token"]').attr('content')
					},
					data:{
						'values':JSON.stringify(products_refund) ,
					},
					success:function(data){
						if (data.message){
							$('#error_quantity').html(data.message)
						}
						else{
							window.location = '/orders'
							}		
					},
				});
			}
		
		});
	})

	// });
</script>
<script type="text/javascript">
	$(document).ready(function(){
	 $('input[class^="refund-id"]').on('click', function() {  
 });
	 })
</script>
<script>  
	function check_condition_status(){
		var condition_status = $("#id_condition_status option:selected").text();
		if( condition_status == 'Refunded with Stock' ){
			$('.refund-with-stock').show();
		}
		else {
			$('.refund-with-stock').hide();
		}
	}


	$(document).ready(function(){
		check_condition_status();

		$('select').change(function(){
			check_condition_status();
		});

	});
</script>


{% endblock %}
